#!/usr/bin/env bash

gum style \
    --foreground 14 --border-foreground 14 --border double \
    --margin "1 0" --padding "0 2" \
    '
██╗   ██╗███████╗ ██████╗ ██████╗ ██████╗ ███████╗
██║   ██║██╔════╝██╔════╝██╔═══██╗██╔══██╗██╔════╝
██║   ██║███████╗██║     ██║   ██║██║  ██║█████╗
╚██╗ ██╔╝╚════██║██║     ██║   ██║██║  ██║██╔══╝
 ╚████╔╝ ███████║╚██████╗╚██████╔╝██████╔╝███████╗
  ╚═══╝  ╚══════╝ ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝
███████╗██╗  ██╗████████╗███████╗███╗   ██╗███████╗██╗ ██████╗ ███╗   ██╗███████╗
██╔════╝╚██╗██╔╝╚══██╔══╝██╔════╝████╗  ██║██╔════╝██║██╔═══██╗████╗  ██║██╔════╝
█████╗   ╚███╔╝    ██║   █████╗  ██╔██╗ ██║███████╗██║██║   ██║██╔██╗ ██║███████╗
██╔══╝   ██╔██╗    ██║   ██╔══╝  ██║╚██╗██║╚════██║██║██║   ██║██║╚██╗██║╚════██║
███████╗██╔╝ ██╗   ██║   ███████╗██║ ╚████║███████║██║╚██████╔╝██║ ╚████║███████║
╚══════╝╚═╝  ╚═╝   ╚═╝   ╚══════╝╚═╝  ╚═══╝╚══════╝╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝
'

dotfiles_dir=$(pwd -P)
editor=$(gum choose "vscode" "cursor" "Exit" --header="Choose editor:")

if [[ $# -eq 1 ]] || [[ $editor == "Exit" ]]; then
    exit 1
fi

if [[ $editor == "vscode" ]]; then
    extensions_dir="$dotfiles_dir/Library/Application Support/Code/User/extensions"
elif [[ $editor == "cursor" ]]; then
    extensions_dir="$dotfiles_dir/Library/Application Support/Cursor/User/extensions"
else
    echo "Unknown editor: $editor"
    exit 1
fi

selected=$(gum choose "Save $editor extensions" "Install $editor extensions" "Exit" --header="Choose action:")

if [[ $# -eq 1 ]] || [[ $selected == "Exit" ]]; then
    exit 1
fi

if [[ $selected == "Save $editor extensions" ]]; then
    echo "Saving $editor extensions..."
    [[ $editor == "vscode" ]] && code --list-extensions > $extensions_dir
    [[ $editor == "cursor" ]] && cursor --list-extensions > $extensions_dir
fi

if [[ $selected == "Install $editor extensions" ]]; then
    if [[ -f "$extensions_dir" ]]; then
        echo "Installing $editor extensions..."
        extension_list=$(cat $extensions_dir)
        for i in "${extension_list[@]}"; do
            [[ $editor == "vscode" ]] && code --install-extension $i
            [[ $editor == "cursor" ]] && cursor --install-extension $i
        done
    else
        echo "$editor extensions file not found."
    fi
fi
